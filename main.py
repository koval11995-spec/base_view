import streamlit as st
import json
import pandas as pd
from typing import Dict, List, Optional


class TreatmentPlanner:
    def __init__(self, knowledge_base_path: Optional[str] = None):
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ª–µ—á–µ–Ω–∏—è"""
        if knowledge_base_path:
            self.load_knowledge_base(knowledge_base_path)
        else:
            # –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
            self.knowledge_base = {
                "disease": [
                    {
                        "name": "–ü–µ—Ä–µ–ª–æ–º—ã –±–µ–¥—Ä–µ–Ω–Ω–æ–π –∫–æ—Å—Ç–∏ (–∫—Ä–æ–º–µ –ø—Ä–æ–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –æ—Ç–¥–µ–ª–∞ –±–µ–¥—Ä–µ–Ω–Ω–æ–π –∫–æ—Å—Ç–∏)",
                        "type_variant": [
                            {
                                "name": "–ü–µ—Ä–µ–ª–æ–º—ã –¥–∏–∞—Ñ–∏–∑–∞ –±–µ–¥—Ä–µ–Ω–Ω–æ–π –∫–æ—Å—Ç–∏",
                                "ICD-10_code": "S72.3",
                                "general_indications": [
                                    "–ü–µ—Ä–µ–ª–æ–º—ã –¥–∏–∞—Ñ–∏–∑–∞ –±–µ–¥—Ä–µ–Ω–Ω–æ–π –∫–æ—Å—Ç–∏",
                                    "–ù–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ–≥–æ –ª–µ—á–µ–Ω–∏—è –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –ø–µ—Ä–µ–ª–æ–º–æ–≤ –¥–∏–∞—Ñ–∏–∑–∞",
                                    "–ü–∞—Ü–∏–µ–Ω—Ç—ã, –∏–º–µ—é—â–∏–µ –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–∫–∞–∑–∞–Ω–∏—è –∫ –∏–Ω—Ç—Ä–∞–º–µ–¥—É–ª–ª—è—Ä–Ω–æ–º—É –æ—Å—Ç–µ–æ—Å–∏–Ω—Ç–µ–∑—É (–¥–ª—è –Ω–∞–∫–æ—Å—Ç–Ω–æ–≥–æ –æ—Å—Ç–µ–æ—Å–∏–Ω—Ç–µ–∑–∞)",
                                    "–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∏–º–º–æ–±–∏–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –≤—ã—Å–æ–∫–æ—ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏—Ö –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏—è—Ö, –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–µ—Ä–µ–ª–æ–º–∞—Ö –∏ –ø–æ–ª–∏—Ç—Ä–∞–≤–º–µ (–¥–ª—è –∞–ø–ø–∞—Ä–∞—Ç–∞ –≤–Ω–µ—à–Ω–µ–π —Ñ–∏–∫—Å–∞—Ü–∏–∏)",
                                    "–ü–∞—Ü–∏–µ–Ω—Ç—ã, –∏–º–µ—é—â–∏–µ –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–∫–∞–∑–∞–Ω–∏—è –∫ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–º—É –æ—Å—Ç–µ–æ—Å–∏–Ω—Ç–µ–∑—É (–¥–ª—è –∞–ø–ø–∞—Ä–∞—Ç–∞ –≤–Ω–µ—à–Ω–µ–π —Ñ–∏–∫—Å–∞—Ü–∏–∏ –∫–∞–∫ –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ–≥–æ –ª–µ—á–µ–Ω–∏—è)"
                                ],
                                "general_contraindications": [
                                    "–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏",
                                    "–î–æ–±—Ä–æ–≤–æ–ª—å–Ω—ã–π –æ—Ç–∫–∞–∑ –ø–∞—Ü–∏–µ–Ω—Ç–∞"
                                ],
                                "stage": [
                                    {
                                        "name_stage": "–ü—Ä–µ–¥–æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞",
                                        "methods": [
                                            {
                                                "name": "–°–∫–µ–ª–µ—Ç–Ω–æ–µ –≤—ã—Ç—è–∂–µ–Ω–∏–µ",
                                                "criteria": {
                                                    "indications": [
                                                        "–¥–æ–æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è –∏–º–º–æ–±–∏–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–ª–æ–º–∞ –¥–∏–∞—Ñ–∏–∑–∞ –±–µ–¥—Ä–µ–Ω–Ω–æ–π –∫–æ—Å—Ç–∏",
                                                        "–æ–±—ä–µ–∫—Ç–∏–≤–Ω–∞—è –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é",
                                                        "–¥–æ–±—Ä–æ–≤–æ–ª—å–Ω—ã–π –æ—Ç–∫–∞–∑ –ø–∞—Ü–∏–µ–Ω—Ç–∞ –æ—Ç —Ö–∏—Ä—É—Ä–≥–∏—á–µ—Å–∫–æ–≥–æ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞"
                                                    ],
                                                    "contraindications": []
                                                },
                                                "materials": {
                                                    "used material": []
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "name_stage": "–•–∏—Ä—É—Ä–≥–∏—á–µ—Å–∫–æ–µ –ª–µ—á–µ–Ω–∏–µ",
                                        "methods": [
                                            {
                                                "name": "–ò–Ω—Ç—Ä–∞–º–µ–¥—É–ª–ª—è—Ä–Ω—ã–π –æ—Å—Ç–µ–æ—Å–∏–Ω—Ç–µ–∑",
                                                "criteria": {
                                                    "indications": [
                                                        "–ø–µ—Ä–µ–ª–æ–º—ã –¥–∏–∞—Ñ–∏–∑–∞ –±–µ–¥—Ä–µ–Ω–Ω–æ–π –∫–æ—Å—Ç–∏"
                                                    ],
                                                    "contraindications": []
                                                },
                                                "materials": {
                                                    "used material": [
                                                        "–∏–Ω—Ç—Ä–∞–º–µ–¥—É–ª–ª—è—Ä–Ω—ã–π —Å—Ç–µ—Ä–∂–µ–Ω—å",
                                                        "–±–ª–æ–∫–∏—Ä—É—é—â–∏–µ –≤–∏–Ω—Ç—ã"
                                                    ]
                                                }
                                            },
                                            {
                                                "name": "–ù–∞–∫–æ—Å—Ç–Ω—ã–π –æ—Å—Ç–µ–æ—Å–∏–Ω—Ç–µ–∑ (–ø–ª–∞—Å—Ç–∏–Ω–æ–π)",
                                                "criteria": {
                                                    "indications": [
                                                        "–ø—Ä–æ—Ç–∏–≤–æ–ø–æ–∫–∞–∑–∞–Ω–∏—è –∫ –∏–Ω—Ç—Ä–∞–º–µ–¥—É–ª–ª—è—Ä–Ω–æ–º—É –æ—Å—Ç–µ–æ—Å–∏–Ω—Ç–µ–∑—É",
                                                        "–ø—Ä–æ—Å—Ç—ã–µ –ø–µ—Ä–µ–ª–æ–º—ã",
                                                        "–º–Ω–æ–≥–æ–æ—Å–∫–æ–ª—å—á–∞—Ç—ã–µ –ø–µ—Ä–µ–ª–æ–º—ã, –æ—Å–æ–±–µ–Ω–Ω–æ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è—é—â–∏–µ—Å—è –Ω–∞ –æ–±–ª–∞—Å—Ç—å –º–µ—Ç–∞—Ñ–∏–∑–æ–≤"
                                                    ],
                                                    "contraindications": []
                                                },
                                                "materials": {
                                                    "used material": [
                                                        "–ø–ª–∞—Å—Ç–∏–Ω–∞",
                                                        "–≤–∏–Ω—Ç—ã –¥–ª—è —Ñ–∏–∫—Å–∞—Ü–∏–∏ –ø–ª–∞—Å—Ç–∏–Ω—ã"
                                                    ]
                                                }
                                            },
                                            {
                                                "name": "–ê–ø–ø–∞—Ä–∞—Ç –≤–Ω–µ—à–Ω–µ–π —Ñ–∏–∫—Å–∞—Ü–∏–∏ (–ê–í–§)",
                                                "criteria": {
                                                    "indications": [
                                                        "–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è (–≤—Ä–µ–º–µ–Ω–Ω–∞—è) –∏–º–º–æ–±–∏–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –≤—ã—Å–æ–∫–æ—ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏—Ö –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏—è—Ö",
                                                        "–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è (–≤—Ä–µ–º–µ–Ω–Ω–∞—è) –∏–º–º–æ–±–∏–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–µ—Ä–µ–ª–æ–º–∞—Ö",
                                                        "–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è (–≤—Ä–µ–º–µ–Ω–Ω–∞—è) –∏–º–º–æ–±–∏–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –ø–æ–ª–∏—Ç—Ä–∞–≤–º–µ (–≤ —Ä–∞–º–∫–∞—Ö —Ç–∞–∫—Ç–∏–∫–∏ –∫–æ–Ω—Ç—Ä–æ–ª—è –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–π ‚Äî Damage Control Orthopaedics)",
                                                        "–ú–µ—Ç–æ–¥ –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ–π —Ñ–∏–∫—Å–∞—Ü–∏–∏ –¥–ª—è –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤, –∏–º–µ—é—â–∏—Ö –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–∫–∞–∑–∞–Ω–∏—è –∫ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–º—É –æ—Å—Ç–µ–æ—Å–∏–Ω—Ç–µ–∑—É"
                                                    ],
                                                    "contraindications": []
                                                },
                                                "materials": {
                                                    "used material": [
                                                        "—Å–ø–∏—Ü—ã",
                                                        "—Å—Ç–µ—Ä–∂–Ω–∏",
                                                        "–Ω–∞—Ä—É–∂–Ω—ã–µ —Ñ–∏–∫—Å–∞—Ç–æ—Ä—ã",
                                                        "–∞–ø–ø–∞—Ä–∞—Ç –≤–Ω–µ—à–Ω–µ–π —Ñ–∏–∫—Å–∞—Ü–∏–∏ (–ê–í–§)"
                                                    ]
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "name_stage": "–ü–æ—Å–ª–µ–æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Ä–µ–∞–±–∏–ª–∏—Ç–∞—Ü–∏—è",
                                        "methods": [
                                            {
                                                "name": "–†–∞–Ω–Ω—è—è –∞–∫—Ç–∏–≤–∏–∑–∞—Ü–∏—è –ø–∞—Ü–∏–µ–Ω—Ç–∞",
                                                "criteria": {
                                                    "indications": [
                                                        "–•–∏—Ä—É—Ä–≥–∏—á–µ—Å–∫–æ–µ –ª–µ—á–µ–Ω–∏–µ –ø–µ—Ä–µ–ª–æ–º–æ–≤ –¥–∏–∞—Ñ–∏–∑–∞ –±–µ–¥—Ä–µ–Ω–Ω–æ–π –∫–æ—Å—Ç–∏"
                                                    ],
                                                    "contraindications": []
                                                },
                                                "materials": {
                                                    "used material": []
                                                }
                                            },
                                            {
                                                "name": "–î–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –æ–ø–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—É—é –∫–æ–Ω–µ—á–Ω–æ—Å—Ç—å",
                                                "criteria": {
                                                    "indications": [],
                                                    "contraindications": []
                                                },
                                                "materials": {
                                                    "used material": []
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "name_stage": "–ü—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∞ –æ—Å–ª–æ–∂–Ω–µ–Ω–∏–π",
                                        "methods": [
                                            {
                                                "name": "–ü—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∞ –≤–µ–Ω–æ–∑–Ω—ã—Ö —Ç—Ä–æ–º–±–æ—ç–º–±–æ–ª–∏—á–µ—Å–∫–∏—Ö –æ—Å–ª–æ–∂–Ω–µ–Ω–∏–π (–í–¢–≠–û)",
                                                "criteria": {
                                                    "indications": [],
                                                    "contraindications": []
                                                },
                                                "materials": {
                                                    "used material": [
                                                        "–∫–æ–º–ø—Ä–µ—Å—Å–∏–æ–Ω–Ω—ã–π —Ç—Ä–∏–∫–æ—Ç–∞–∂",
                                                        "—Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –º–∞–Ω–∂–µ—Ç—ã –¥–ª—è –ø—Ä–µ—Ä—ã–≤–∏—Å—Ç–æ–π –ø–Ω–µ–≤–º–æ–∫–æ–º–ø—Ä–µ—Å—Å–∏–∏",
                                                        "–Ω–∏–∑–∫–æ–º–æ–ª–µ–∫—É–ª—è—Ä–Ω—ã–µ –≥–µ–ø–∞—Ä–∏–Ω—ã (–ù–ú–ì)"
                                                    ]
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "name_stage": "–î–∏—Å–ø–∞–Ω—Å–µ—Ä–Ω–æ–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ",
                                        "methods": [
                                            {
                                                "name": "–î–∏—Å–ø–∞–Ω—Å–µ—Ä–Ω—ã–π –ø—Ä–∏–µ–º –≤—Ä–∞—á–∞-—Ç—Ä–∞–≤–º–∞—Ç–æ–ª–æ–≥–∞-–æ—Ä—Ç–æ–ø–µ–¥–∞",
                                                "criteria": {
                                                    "indications": [],
                                                    "contraindications": []
                                                },
                                                "materials": {
                                                    "used material": []
                                                }
                                            }
                                        ]
                                    }
                                ]
                            },
                            {
                                "name": "–ü–µ—Ä–µ–ª–æ–º—ã –¥–∏—Å—Ç–∞–ª—å–Ω–æ–≥–æ –æ—Ç–¥–µ–ª–∞ –±–µ–¥—Ä–µ–Ω–Ω–æ–π –∫–æ—Å—Ç–∏ (–î–û–ë–ö)",
                                "ICD-10_code": "S72.4",
                                "general_indications": [
                                    "–ü–µ—Ä–µ–ª–æ–º—ã –î–û–ë–ö —Å–æ —Å–º–µ—â–µ–Ω–∏–µ–º –∫–æ—Å—Ç–Ω—ã—Ö –æ—Ç–ª–æ–º–∫–æ–≤, –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–∫–∞–∑–∞–Ω–∏–π"
                                ],
                                "general_contraindications": [
                                    "–ù–∞–ª–∏—á–∏–µ –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–∫–∞–∑–∞–Ω–∏–π –∫ –æ—Å—Ç–µ–æ—Å–∏–Ω—Ç–µ–∑—É (–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–∫–∞–∑–∞–Ω–∏—è –Ω–µ —É–∫–∞–∑–∞–Ω—ã –≤ —Ç–µ–∫—Å—Ç–µ)"
                                ],
                                "stage": [
                                    {
                                        "name_stage": "–•–∏—Ä—É—Ä–≥–∏—á–µ—Å–∫–æ–µ –ª–µ—á–µ–Ω–∏–µ (–æ—Å—Ç–µ–æ—Å–∏–Ω—Ç–µ–∑)",
                                        "methods": [
                                            {
                                                "name": "–æ—Å—Ç–µ–æ—Å–∏–Ω—Ç–µ–∑",
                                                "criteria": {
                                                    "indications": [
                                                        "–ü–µ—Ä–µ–ª–æ–º—ã –¥–∏—Å—Ç–∞–ª—å–Ω–æ–≥–æ –æ—Ç–¥–µ–ª–∞ –±–µ–¥—Ä–µ–Ω–Ω–æ–π –∫–æ—Å—Ç–∏ —Å–æ —Å–º–µ—â–µ–Ω–∏–µ–º –∫–æ—Å—Ç–Ω—ã—Ö –æ—Ç–ª–æ–º–∫–æ–≤, –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–∫–∞–∑–∞–Ω–∏–π –∫ –æ–ø–µ—Ä–∞—Ü–∏–∏"
                                                    ],
                                                    "contraindications": []
                                                },
                                                "materials": {
                                                    "used material": [
                                                        "–∏–Ω—Ç—Ä–∞–º–µ–¥—É–ª–ª—è—Ä–Ω—ã–π —Å—Ç–µ—Ä–∂–µ–Ω—å",
                                                        "–ø–ª–∞—Å—Ç–∏–Ω—ã",
                                                        "–≤–∏–Ω—Ç—ã"
                                                    ]
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "name_stage": "–ü–æ—Å–ª–µ–æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ (–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è —Ä–µ–∞–±–∏–ª–∏—Ç–∞—Ü–∏—è)",
                                        "methods": [
                                            {
                                                "name": "—Ä–∞–Ω–Ω—è—è –∞–∫—Ç–∏–≤–∏–∑–∞—Ü–∏—è –ø–∞—Ü–∏–µ–Ω—Ç–∞",
                                                "criteria": {
                                                    "indications": [],
                                                    "contraindications": []
                                                },
                                                "materials": {
                                                    "used material": []
                                                }
                                            },
                                            {
                                                "name": "–º–æ–±–∏–ª–∏–∑–∞—Ü–∏—è –ø–∞—Ü–∏–µ–Ω—Ç–∞",
                                                "criteria": {
                                                    "indications": [],
                                                    "contraindications": []
                                                },
                                                "materials": {
                                                    "used material": []
                                                }
                                            },
                                            {
                                                "name": "–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—ä–µ–º–∞ –¥–≤–∏–∂–µ–Ω–∏–π –≤ —Ç–∞–∑–æ–±–µ–¥—Ä–µ–Ω–Ω–æ–º –∏ –∫–æ–ª–µ–Ω–Ω–æ–º —Å—É—Å—Ç–∞–≤–∞—Ö",
                                                "criteria": {
                                                    "indications": [
                                                        "—Ä–∞–Ω–Ω—è—è –ø–æ—Å–ª–µ–æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è —Ä–µ–∞–±–∏–ª–∏—Ç–∞—Ü–∏—è –ø–æ—Å–ª–µ —Ö–∏—Ä—É—Ä–≥–∏—á–µ—Å–∫–æ–≥–æ –ª–µ—á–µ–Ω–∏—è (–æ—Å—Ç–µ–æ—Å–∏–Ω—Ç–µ–∑–∞) –ø–µ—Ä–µ–ª–æ–º–æ–≤ –¥–∏—Å—Ç–∞–ª—å–Ω–æ–≥–æ –æ—Ç–¥–µ–ª–∞ –±–µ–¥—Ä–µ–Ω–Ω–æ–π –∫–æ—Å—Ç–∏ (–î–û–ë–ö)"
                                                    ],
                                                    "contraindications": []
                                                },
                                                "materials": {
                                                    "used material": []
                                                }
                                            },
                                            {
                                                "name": "–Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –æ–ø–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—É—é –∫–æ–Ω–µ—á–Ω–æ—Å—Ç—å –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –ø–æ—Å–ª–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (–ø–æ—Å–ª–µ –∏–Ω—Ç—Ä–∞–º–µ–¥—É–ª–ª—è—Ä–Ω–æ–≥–æ –æ—Å—Ç–µ–æ—Å–∏–Ω—Ç–µ–∑–∞)",
                                                "criteria": {
                                                    "indications": [
                                                        "–¥–∏–∞—Ñ–∏–∑–∞—Ä–Ω—ã–µ –∏ –≤–Ω–µ—Å—É—Å—Ç–∞–≤–Ω—ã–µ –ø–µ—Ä–µ–ª–æ–º—ã –¥–∏—Å—Ç–∞–ª—å–Ω–æ–≥–æ –æ—Ç–¥–µ–ª–∞ –±–µ–¥—Ä–µ–Ω–Ω–æ–π –∫–æ—Å—Ç–∏",
                                                        "–º–Ω–æ–≥–æ–æ—Å–∫–æ–ª—å—á–∞—Ç—ã–µ –ø–µ—Ä–µ–ª–æ–º—ã –¥–∏—Å—Ç–∞–ª—å–Ω–æ–≥–æ –æ—Ç–¥–µ–ª–∞ –±–µ–¥—Ä–µ–Ω–Ω–æ–π –∫–æ—Ç–∏"
                                                    ],
                                                    "contraindications": []
                                                },
                                                "materials": {
                                                    "used material": []
                                                }
                                            },
                                            {
                                                "name": "–æ—Å–µ–≤–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –∫–æ–Ω–µ—á–Ω–æ—Å—Ç—å –Ω–µ —Ä–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è –≤ —Ç–µ—á–µ–Ω–∏–µ 6-8 –Ω–µ–¥–µ–ª—å –ø–æ—Å–ª–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (–ø–æ—Å–ª–µ –æ—Å—Ç–µ–æ—Å–∏–Ω—Ç–µ–∑–∞ –ø–ª–∞—Å—Ç–∏–Ω–∞–º–∏)",
                                                "criteria": {
                                                    "indications": [
                                                        "–ü–æ—Å–ª–µ –æ—Å—Ç–µ–æ—Å–∏–Ω—Ç–µ–∑–∞ –ø–ª–∞—Å—Ç–∏–Ω–∞–º–∏ –ø—Ä–∏ –ø–µ—Ä–µ–ª–æ–º–∞—Ö –¥–∏—Å—Ç–∞–ª—å–Ω–æ–≥–æ –æ—Ç–¥–µ–ª–∞ –±–µ–¥—Ä–µ–Ω–Ω–æ–π –∫–æ—Å—Ç–∏ (–î–û–ë–ö)"
                                                    ],
                                                    "contraindications": []
                                                },
                                                "materials": {
                                                    "used material": []
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "name_stage": "–ü—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∞ –æ—Å–ª–æ–∂–Ω–µ–Ω–∏–π",
                                        "methods": [
                                            {
                                                "name": "—ç–ª–∞—Å—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–º–ø—Ä–µ—Å—Å–∏—è –Ω–∏–∂–Ω–∏—Ö –∫–æ–Ω–µ—á–Ω–æ—Å—Ç–µ–π",
                                                "criteria": {
                                                    "indications": [
                                                        "–ü—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∞ –æ—Å–ª–æ–∂–Ω–µ–Ω–∏–π –ø–æ—Å–ª–µ —Ö–∏—Ä—É—Ä–≥–∏—á–µ—Å–∫–æ–≥–æ –ª–µ—á–µ–Ω–∏—è –ø–µ—Ä–µ–ª–æ–º–æ–≤ –¥–∏—Å—Ç–∞–ª—å–Ω–æ–≥–æ –æ—Ç–¥–µ–ª–∞ –±–µ–¥—Ä–µ–Ω–Ω–æ–π –∫–æ—Å—Ç–∏ (–î–û–ë–ö)",
                                                        "–ú–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∞—è –ø—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∞ –≤–µ–Ω–æ–∑–Ω—ã—Ö —Ç—Ä–æ–º–±–æ—ç–º–±–æ–ª–∏—á–µ—Å–∫–∏—Ö –æ—Å–ª–æ–∂–Ω–µ–Ω–∏–π (–í–¢–≠–û), —Ç–∞–∫–∏—Ö –∫–∞–∫ —Ç—Ä–æ–º–±–æ–∑ –≥–ª—É–±–æ–∫–∏—Ö –≤–µ–Ω –∏ —Ç—Ä–æ–º–±–æ—ç–º–±–æ–ª–∏—è –ª–µ–≥–æ—á–Ω–æ–π –∞—Ä—Ç–µ—Ä–∏–∏",
                                                        "–ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –≤ —Ä–∞–º–∫–∞—Ö –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–π –ø—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∏ –í–¢–≠–û —É –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤, –ø–µ—Ä–µ–Ω–µ—Å—à–∏—Ö –æ—Å—Ç–µ–æ—Å–∏–Ω—Ç–µ–∑ –ø–æ –ø–æ–≤–æ–¥—É –ø–µ—Ä–µ–ª–æ–º–∞ –±–µ–¥—Ä–µ–Ω–Ω–æ–π –∫–æ—Å—Ç–∏",
                                                        "–ü–∞—Ü–∏–µ–Ω—Ç—ã —Å —Ç–∞–∫–∏–º–∏ –ø–µ—Ä–µ–ª–æ–º–∞–º–∏ –æ—Ç–Ω–æ—Å—è—Ç—Å—è –∫ –≥—Ä—É–ø–ø–µ –≤—ã—Å–æ–∫–æ–≥–æ —Ä–∏—Å–∫–∞ —Ä–∞–∑–≤–∏—Ç–∏—è —Ç—Ä–æ–º–±–æ—ç–º–±–æ–ª–∏—á–µ—Å–∫–∏—Ö –æ—Å–ª–æ–∂–Ω–µ–Ω–∏–π"
                                                    ],
                                                    "contraindications": []
                                                },
                                                "materials": {
                                                    "used material": [
                                                        "—ç–ª–∞—Å—Ç–∏—á–Ω—ã–µ –∫–æ–º–ø—Ä–µ—Å—Å–∏–æ–Ω–Ω—ã–µ –∏–∑–¥–µ–ª–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á—É–ª–∫–∏, –±–∏–Ω—Ç—ã)"
                                                    ]
                                                }
                                            },
                                            {
                                                "name": "–ø—Ä–µ—Ä—ã–≤–∏—Å—Ç–∞—è –ø–Ω–µ–≤–º–æ–∫–æ–º–ø—Ä–µ—Å—Å–∏—è",
                                                "criteria": {
                                                    "indications": [
                                                        "–ø—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∞ –≤–µ–Ω–æ–∑–Ω—ã—Ö —Ç—Ä–æ–º–±–æ—ç–º–±–æ–ª–∏—á–µ—Å–∫–∏—Ö –æ—Å–ª–æ–∂–Ω–µ–Ω–∏–π (–í–¢–≠–û) —É –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤ —Å –ø–µ—Ä–µ–ª–æ–º–∞–º–∏ –±–µ–¥—Ä–µ–Ω–Ω–æ–π –∫–æ—Å—Ç–∏, –∫–æ—Ç–æ—Ä—ã–µ –æ—Ç–Ω–æ—Å—è—Ç—Å—è –∫ –≥—Ä—É–ø–ø–µ –≤—ã—Å–æ–∫–æ–≥–æ —Ä–∏—Å–∫–∞"
                                                    ],
                                                    "contraindications": []
                                                },
                                                "materials": {
                                                    "used material": [
                                                        "–º–∞–Ω–∂–µ—Ç—ã –∏–ª–∏ —Å–∞–ø–æ–∂–∫–∏ –¥–ª—è –ø—Ä–µ—Ä—ã–≤–∏—Å—Ç–æ–π –ø–Ω–µ–≤–º–æ–∫–æ–º–ø—Ä–µ—Å—Å–∏–∏",
                                                        "—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –¥–ª—è –Ω–∞–≥–Ω–µ—Ç–∞–Ω–∏—è –≤–æ–∑–¥—É—Ö–∞"
                                                    ]
                                                }
                                            },
                                            {
                                                "name": "–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∞–Ω—Ç–∏–∫–æ–∞–≥—É–ª—è–Ω—Ç–æ–≤ (–∞–Ω—Ç–∏—Ç—Ä–æ–º–±–æ—Ç–∏—á–µ—Å–∫–∏—Ö —Å—Ä–µ–¥—Å—Ç–≤)",
                                                "criteria": {
                                                    "indications": [
                                                        "–ü–∞—Ü–∏–µ–Ω—Ç—ã —Å –ø–µ—Ä–µ–ª–æ–º–∞–º–∏ –±–µ–¥—Ä–µ–Ω–Ω–æ–π –∫–æ—Å—Ç–∏ (–≤–∫–ª—é—á–∞—è –¥–∏—Å—Ç–∞–ª—å–Ω—ã–π –æ—Ç–¥–µ–ª ‚Äî –î–û–ë–ö) –æ—Ç–Ω–æ—Å—è—Ç—Å—è –∫ –≥—Ä—É–ø–ø–µ –≤—ã—Å–æ–∫–æ–≥–æ —Ä–∏—Å–∫–∞ —Ä–∞–∑–≤–∏—Ç–∏—è –í–¢–≠–û"
                                                    ],
                                                    "contraindications": []
                                                },
                                                "materials": {
                                                    "used material": []
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "name_stage": "–î–∏—Å–ø–∞–Ω—Å–µ—Ä–Ω–æ–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ",
                                        "methods": [
                                            {
                                                "name": "–¥–∏—Å–ø–∞–Ω—Å–µ—Ä–Ω—ã–π –ø—Ä–∏–µ–º –≤—Ä–∞—á–∞-—Ç—Ä–∞–≤–º–∞—Ç–æ–ª–æ–≥–∞-–æ—Ä—Ç–æ–ø–µ–¥–∞",
                                                "criteria": {
                                                    "indications": [],
                                                    "contraindications": []
                                                },
                                                "materials": {
                                                    "used material": []
                                                }
                                            }
                                        ]
                                    }
                                ]
                            }
                        ]
                    }
                ]
            }

    def load_knowledge_base(self, filepath: str):
        """–ó–∞–≥—Ä—É–∑–∫–∞ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π –∏–∑ JSON —Ñ–∞–π–ª–∞"""
        with open(filepath, 'r', encoding='utf-8') as f:
            self.knowledge_base = json.load(f)

    def get_diseases(self) -> List[str]:
        """–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏–π"""
        diseases = []
        for disease in self.knowledge_base["disease"]:
            diseases.append(disease["name"])
        return diseases

    def get_disease_variants(self, disease_name: str) -> List[Dict]:
        """–ü–æ–ª—É—á–µ–Ω–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è"""
        for disease in self.knowledge_base["disease"]:
            if disease["name"] == disease_name:
                return disease["type_variant"]
        return []

    def get_treatment_plan(self, disease_name: str, variant_name: str) -> Dict:
        """–ü–æ–ª—É—á–µ–Ω–∏–µ –ø–ª–∞–Ω–∞ –ª–µ—á–µ–Ω–∏—è –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è"""
        for disease in self.knowledge_base["disease"]:
            if disease["name"] == disease_name:
                for variant in disease["type_variant"]:
                    if variant["name"] == variant_name:
                        return {
                            "disease": disease_name,
                            "variant": variant_name,
                            "icd10": variant["ICD-10_code"],
                            "general_indications": variant["general_indications"],
                            "general_contraindications": variant["general_contraindications"],
                            "stages": variant["stage"]
                        }
        return {}

    def search_methods_by_keyword(self, keyword: str) -> List[Dict]:
        """–ü–æ–∏—Å–∫ –º–µ—Ç–æ–¥–æ–≤ –ª–µ—á–µ–Ω–∏—è –ø–æ –∫–ª—é—á–µ–≤–æ–º—É —Å–ª–æ–≤—É"""
        results = []
        keyword_lower = keyword.lower()

        for disease in self.knowledge_base["disease"]:
            for variant in disease["type_variant"]:
                for stage in variant["stage"]:
                    for method in stage["methods"]:
                        # –ü–æ–∏—Å–∫ –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏ –º–µ—Ç–æ–¥–∞
                        if keyword_lower in method["name"].lower():
                            results.append({
                                "disease": disease["name"],
                                "variant": variant["name"],
                                "stage": stage["name_stage"],
                                "method": method["name"],
                                "indications": method["criteria"]["indications"],
                                "contraindications": method["criteria"]["contraindications"],
                                "materials": method["materials"]["used material"]
                            })
                        # –ü–æ–∏—Å–∫ –≤ –ø–æ–∫–∞–∑–∞–Ω–∏—è—Ö
                        for indication in method["criteria"]["indications"]:
                            if keyword_lower in indication.lower():
                                results.append({
                                    "disease": disease["name"],
                                    "variant": variant["name"],
                                    "stage": stage["name_stage"],
                                    "method": method["name"],
                                    "indications": method["criteria"]["indications"],
                                    "contraindications": method["criteria"]["contraindications"],
                                    "materials": method["materials"]["used material"]
                                })
                                break
        return results


def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è Streamlit –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"""
    st.set_page_config(
        page_title="–°–∏—Å—Ç–µ–º–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ª–µ—á–µ–Ω–∏—è –≤ —Ç—Ä–∞–≤–º–∞—Ç–æ–ª–æ–≥–∏–∏",
        page_icon="üè•",
        layout="wide"
    )

    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã
    if 'planner' not in st.session_state:
        st.session_state.planner = TreatmentPlanner()

    planner = st.session_state.planner

    # –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    st.title("üè• –°–∏—Å—Ç–µ–º–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ª–µ—á–µ–Ω–∏—è –≤ —Ç—Ä–∞–≤–º–∞—Ç–æ–ª–æ–≥–∏–∏ –∏ –æ—Ä—Ç–æ–ø–µ–¥–∏–∏")
    st.markdown("---")

    # –°–∞–π–¥–±–∞—Ä —Å –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π
    with st.sidebar:
        st.header("–ù–∞–≤–∏–≥–∞—Ü–∏—è")
        app_mode = st.radio(
            "–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã:",
            ["–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–µ—á–µ–Ω–∏—è", "–ü–æ–∏—Å–∫ –º–µ—Ç–æ–¥–æ–≤", "–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π"]
        )

        st.markdown("---")
        st.info("""
        **–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ:**

        –≠—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ –ø–æ–º–æ–≥–∞–µ—Ç –≤ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ –ª–µ—á–µ–Ω–∏—è 
        –ø–µ—Ä–µ–ª–æ–º–æ–≤ –±–µ–¥—Ä–µ–Ω–Ω–æ–π –∫–æ—Å—Ç–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–ª–∏–Ω–∏—á–µ—Å–∫–∏—Ö 
        —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –∏ –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤.
        """)

    # –†–µ–∂–∏–º –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ª–µ—á–µ–Ω–∏—è
    if app_mode == "–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–µ—á–µ–Ω–∏—è":
        st.header("–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–µ—á–µ–Ω–∏—è")

        col1, col2 = st.columns(2)

        with col1:
            # –í—ã–±–æ—Ä –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è
            diseases = planner.get_diseases()
            selected_disease = st.selectbox(
                "–í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏–µ:",
                diseases
            )

            # –í—ã–±–æ—Ä –≤–∞—Ä–∏–∞–Ω—Ç–∞ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è
            if selected_disease:
                variants = planner.get_disease_variants(selected_disease)
                variant_names = [v["name"] for v in variants]

                if variant_names:
                    selected_variant = st.selectbox(
                        "–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –ø–µ—Ä–µ–ª–æ–º–∞:",
                        variant_names
                    )

        with col2:
            # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º –≤–∞—Ä–∏–∞–Ω—Ç–µ
            if selected_disease and selected_variant:
                variant_info = next(
                    (v for v in planner.get_disease_variants(selected_disease)
                     if v["name"] == selected_variant),
                    None
                )

                if variant_info:
                    st.subheader("üìã –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è")
                    st.write(f"**–ö–æ–¥ –ú–ö–ë-10:** {variant_info['ICD-10_code']}")

                    with st.expander("–ü–æ–∫–∞–∑–∞–Ω–∏—è –∫ –ª–µ—á–µ–Ω–∏—é"):
                        for indication in variant_info['general_indications']:
                            st.write(f"‚Ä¢ {indication}")

                    with st.expander("–ü—Ä–æ—Ç–∏–≤–æ–ø–æ–∫–∞–∑–∞–Ω–∏—è"):
                        if variant_info['general_contraindications']:
                            for contraindication in variant_info['general_contraindications']:
                                st.write(f"‚Ä¢ {contraindication}")
                        else:
                            st.write("–ü—Ä–æ—Ç–∏–≤–æ–ø–æ–∫–∞–∑–∞–Ω–∏—è –Ω–µ —É–∫–∞–∑–∞–Ω—ã")

        # –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–ª–∞–Ω–∞ –ª–µ—á–µ–Ω–∏—è
        if selected_disease and selected_variant:
            st.markdown("---")
            st.header("üìã –ü–ª–∞–Ω –ª–µ—á–µ–Ω–∏—è")

            treatment_plan = planner.get_treatment_plan(selected_disease, selected_variant)

            if treatment_plan:
                # –°–æ–∑–¥–∞–µ–º —Ç–∞–±—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞ –ª–µ—á–µ–Ω–∏—è
                tabs = st.tabs([stage["name_stage"] for stage in treatment_plan["stages"]])

                for i, tab in enumerate(tabs):
                    with tab:
                        stage = treatment_plan["stages"][i]
                        st.subheader(stage["name_stage"])

                        if stage["methods"]:
                            for method in stage["methods"]:
                                with st.expander(f"üìå {method['name']}"):
                                    # –ü–æ–∫–∞–∑–∞–Ω–∏—è
                                    if method['criteria']['indications']:
                                        st.write("**–ü–æ–∫–∞–∑–∞–Ω–∏—è:**")
                                        for indication in method['criteria']['indications']:
                                            st.write(f"‚Ä¢ {indication}")
                                    else:
                                        st.write("**–ü–æ–∫–∞–∑–∞–Ω–∏—è:** –Ω–µ —É–∫–∞–∑–∞–Ω—ã")

                                    # –ü—Ä–æ—Ç–∏–≤–æ–ø–æ–∫–∞–∑–∞–Ω–∏—è
                                    if method['criteria']['contraindications']:
                                        st.write("**–ü—Ä–æ—Ç–∏–≤–æ–ø–æ–∫–∞–∑–∞–Ω–∏—è:**")
                                        for contraindication in method['criteria']['contraindications']:
                                            st.write(f"‚Ä¢ {contraindication}")
                                    else:
                                        st.write("**–ü—Ä–æ—Ç–∏–≤–æ–ø–æ–∫–∞–∑–∞–Ω–∏—è:** –Ω–µ —É–∫–∞–∑–∞–Ω—ã")

                                    # –ú–∞—Ç–µ—Ä–∏–∞–ª—ã –∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ
                                    if method['materials']['used material']:
                                        st.write("**–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã:**")
                                        for material in method['materials']['used material']:
                                            st.write(f"‚Ä¢ {material}")
                                    else:
                                        st.write("**–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã:** –Ω–µ —É–∫–∞–∑–∞–Ω—ã")
                        else:
                            st.info("–ú–µ—Ç–æ–¥—ã –ª–µ—á–µ–Ω–∏—è –¥–ª—è —ç—Ç–æ–≥–æ —ç—Ç–∞–ø–∞ –Ω–µ —É–∫–∞–∑–∞–Ω—ã")

            # –ö–Ω–æ–ø–∫–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—á–µ—Ç–∞
            if st.button("üìÑ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á–µ—Ç –æ –ª–µ—á–µ–Ω–∏–∏"):
                generate_treatment_report(treatment_plan)

    # –†–µ–∂–∏–º –ø–æ–∏—Å–∫–∞ –º–µ—Ç–æ–¥–æ–≤
    elif app_mode == "–ü–æ–∏—Å–∫ –º–µ—Ç–æ–¥–æ–≤":
        st.header("üîç –ü–æ–∏—Å–∫ –º–µ—Ç–æ–¥–æ–≤ –ª–µ—á–µ–Ω–∏—è")

        search_term = st.text_input(
            "–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ –¥–ª—è –ø–æ–∏—Å–∫–∞:",
            placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –æ—Å—Ç–µ–æ—Å–∏–Ω—Ç–µ–∑, –ø—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∞, —Ä–µ–∞–±–∏–ª–∏—Ç–∞—Ü–∏—è..."
        )

        if search_term:
            results = planner.search_methods_by_keyword(search_term)

            if results:
                st.write(f"–ù–∞–π–¥–µ–Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤: {len(results)}")

                for result in results:
                    with st.expander(f"{result['method']} ({result['disease']} - {result['stage']})"):
                        st.write(f"**–ó–∞–±–æ–ª–µ–≤–∞–Ω–∏–µ:** {result['disease']}")
                        st.write(f"**–¢–∏–ø:** {result['variant']}")
                        st.write(f"**–≠—Ç–∞–ø:** {result['stage']}")

                        if result['indications']:
                            st.write("**–ü–æ–∫–∞–∑–∞–Ω–∏—è:**")
                            for indication in result['indications']:
                                st.write(f"‚Ä¢ {indication}")

                        if result['materials']:
                            st.write("**–ú–∞—Ç–µ—Ä–∏–∞–ª—ã:**")
                            for material in result['materials']:
                                st.write(f"‚Ä¢ {material}")
            else:
                st.warning("–ü–æ –≤–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ")

    # –†–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
    elif app_mode == "–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π":
        st.header("üìö –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π")

        # –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
        for disease in planner.knowledge_base["disease"]:
            with st.expander(f"üìÅ {disease['name']}", expanded=True):
                for variant in disease["type_variant"]:
                    st.subheader(f"üìÑ {variant['name']} (–ú–ö–ë-10: {variant['ICD-10_code']})")

                    # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –º–µ—Ç–æ–¥–∞–º
                    total_methods = 0
                    for stage in variant["stage"]:
                        total_methods += len(stage["methods"])

                    col1, col2, col3 = st.columns(3)
                    with col1:
                        st.metric("–≠—Ç–∞–ø–æ–≤ –ª–µ—á–µ–Ω–∏—è", len(variant["stage"]))
                    with col2:
                        st.metric("–í—Å–µ–≥–æ –º–µ—Ç–æ–¥–æ–≤", total_methods)
                    with col3:
                        st.metric("–ü–æ–∫–∞–∑–∞–Ω–∏–π", len(variant["general_indications"]))

                    # –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ —ç—Ç–∞–ø–∞–º
                    for stage in variant["stage"]:
                        st.write(f"**{stage['name_stage']}** ({len(stage['methods'])} –º–µ—Ç–æ–¥–æ–≤)")


def generate_treatment_report(treatment_plan: Dict):
    """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞ –æ –ª–µ—á–µ–Ω–∏–∏"""
    report_text = f"""
    # –û–¢–ß–ï–¢ –û –ü–õ–ê–ù–ï –õ–ï–ß–ï–ù–ò–Ø

    ## –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
    **–ó–∞–±–æ–ª–µ–≤–∞–Ω–∏–µ:** {treatment_plan['disease']}
    **–¢–∏–ø –ø–µ—Ä–µ–ª–æ–º–∞:** {treatment_plan['variant']}
    **–ö–æ–¥ –ú–ö–ë-10:** {treatment_plan['icd10']}

    ## –û–±—â–∏–µ –ø–æ–∫–∞–∑–∞–Ω–∏—è
    {chr(10).join(f'‚Ä¢ {ind}' for ind in treatment_plan['general_indications'])}

    ## –û–±—â–∏–µ –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–∫–∞–∑–∞–Ω–∏—è
    {chr(10).join(f'‚Ä¢ {contra}' for contra in treatment_plan['general_contraindications']) if treatment_plan['general_contraindications'] else '–ù–µ —É–∫–∞–∑–∞–Ω—ã'}

    ## –ü–ª–∞–Ω –ª–µ—á–µ–Ω–∏—è
    """

    for stage in treatment_plan['stages']:
        report_text += f"\n### {stage['name_stage']}\n"

        for method in stage['methods']:
            report_text += f"\n**{method['name']}**\n"

            if method['criteria']['indications']:
                report_text += "–ü–æ–∫–∞–∑–∞–Ω–∏—è:\n"
                for ind in method['criteria']['indications']:
                    report_text += f"‚Ä¢ {ind}\n"

            if method['materials']['used material']:
                report_text += "–ú–∞—Ç–µ—Ä–∏–∞–ª—ã:\n"
                for material in method['materials']['used material']:
                    report_text += f"‚Ä¢ {material}\n"

    # –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—Ç—á–µ—Ç–∞
    st.markdown("---")
    st.header("üìÑ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç—á–µ—Ç")
    st.markdown(report_text)

    # –ö–Ω–æ–ø–∫–∞ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
    st.download_button(
        label="üì• –°–∫–∞—á–∞—Ç—å –æ—Ç—á–µ—Ç",
        data=report_text,
        file_name=f"treatment_plan_{treatment_plan['variant'].replace(' ', '_')}.md",
        mime="text/markdown"
    )


if __name__ == "__main__":
    main()